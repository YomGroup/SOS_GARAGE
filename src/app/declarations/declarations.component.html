<div class="claim-declaration">
      <div class="container">
        <h1>Déclarez un sinistre</h1>
        <p class="instruction">Veillez remplir l'ensemble du formulaire</p>

        <div class="progress-indicator">
          <div class="step" [class.active]="currentStep >= 1" [class.completed]="currentStep > 1">1</div>
          <div class="step" [class.active]="currentStep >= 2" [class.completed]="currentStep > 2">2</div>
          <div class="step" [class.active]="currentStep >= 3" [class.completed]="currentStep > 3">3</div>
          <div class="step" [class.active]="currentStep >= 4" [class.completed]="currentStep > 4">4</div>
          <div class="step" [class.active]="currentStep >= 5" [class.completed]="currentStep > 5">5</div>
        </div>

        <!-- Step 1: Vehicle Status -->
      <div class="step-content" *ngIf="currentStep === 2">
  <h2>Information sur le véhicule</h2>
  <div class="vehicle-status">
    <div class="radio-group">
      <input type="radio" id="rolling" name="vehicleStatus" value="rolling" 
             [(ngModel)]="vehicleStatus" (change)="onStatusChange()">
      <label for="rolling" class="radio-label">
        <i class="icon-car-ok"></i>
        Mon véhicule est roulant
      </label>
    </div>
    <div class="radio-group">
      <input type="radio" id="not-rolling" name="vehicleStatus" value="not-rolling" 
             [(ngModel)]="vehicleStatus" (change)="onStatusChange()">
      <label for="not-rolling" class="radio-label">
        <i class="icon-car-damaged"></i>
        Mon véhicule est Non roulant
      </label>
    </div>
  </div>
</div>

       <!-- Step 2: Vehicle Selection -->
<!-- Step 2: Vehicle Selection -->
<div class="step-content" *ngIf="currentStep === 1">
  <h2>Choisissez votre véhicule accidenté</h2>

  <div class="vehicle-selection">
    <div class="vehicle-dropdown" 
         [class.open]="isDropdownOpen"
         (click)="toggleDropdown()">
      <span>{{ selectedVehicle || 'Sélectionner un véhicule' }}</span>
    </div>

    <ul class="dropdown-list" *ngIf="isDropdownOpen">
      <li *ngFor="let vehicle of vehicles" 
          (click)="selectVehicle(vehicle)">
        {{ vehicle }}
      </li>
    </ul>
  </div>

  <!-- Assurance selection (only shown for non-rolling vehicles) -->
  <div class="assurance-selection" *ngIf="showAssuranceStep && selectedVehicle">
    <h2>Sélectionnez votre assurance</h2>
    
    <div class="vehicle-dropdown" 
         [class.open]="isAssuranceDropdownOpen"
         (click)="toggleAssuranceDropdown()">
      <span>{{ selectedAssurance || 'Sélectionner une assurance' }}</span>
    </div>

    <ul class="dropdown-list" *ngIf="isAssuranceDropdownOpen">
      <li *ngFor="let assurance of assurances" 
          (click)="selectAssurance(assurance)">
        {{ assurance }}
      </li>
    </ul>
    
    <div *ngIf="assurances.length === 0" class="no-assurances">
      <p>Aucune assurance disponible pour ce véhicule</p>
    </div>
  </div>
</div>
        <!-- Step 3: Constat -->
       <!-- Step 3: Constat -->
     <div class="step-content" *ngIf="currentStep === 3">
  <h2>Déclaration de l'incident</h2>

  <!-- Choix initial -->
  <div class="choice-container" *ngIf="!hasChosenDeclarationMethod">
    <div class="choice-card" (click)="selectDeclarationMethod('describe')">
      <i class="bi bi-text-paragraph"></i>
      <h3>Décrire l'incident</h3>
      <p>Racontez ce qui s'est passé en détail</p>
    </div>
    
    <div class="choice-card" (click)="selectDeclarationMethod('upload')">
      <i class="bi bi-file-earmark-arrow-up"></i>
      <h3>Téléverser un constat</h3>
      <p>Uploader votre constat amiable rempli</p>
    </div>
  </div>

  <!-- Section description -->
  <div class="description-section" *ngIf="hasChosenDeclarationMethod && declarationMethod === 'describe'">
    <div class="section-header">
      <button class="btn-back" (click)="resetDeclarationMethod()">
        <i class="bi bi-arrow-left"></i> Retour
      </button>
      <h3><i class="bi bi-text-paragraph"></i> Description de l'incident</h3>
    </div>
    
    <textarea class="form-control" rows="6" 
              [(ngModel)]="incidentDescription" 
              placeholder="Décrivez précisément ce qui s'est passé (lieu, heure, circonstances, dégâts apparents...)"></textarea>
    <p class="help-text">Plus votre description sera précise, plus nous pourrons traiter votre dossier rapidement.</p>
  </div>

  <!-- Section upload -->
  <div class="upload-section" *ngIf="hasChosenDeclarationMethod && declarationMethod === 'upload'">
    <div class="section-header">
      <button class="btn-back" (click)="resetDeclarationMethod()">
        <i class="bi bi-arrow-left"></i> Retour
      </button>
      <h3><i class="bi bi-file-earmark-arrow-up"></i> Téléverser un constat</h3>
    </div>
    
    <div class="file-upload">
      <div class="upload-area" (click)="fileInput.click()">
        <p><i class="bi bi-upload"></i> Téléverser votre constat</p>
        <input #fileInput type="file" accept=".pdf,.jpg,.png" 
               (change)="onFileSelect($event)" style="display: none;">
      </div>
      
      <div class="preview-container" *ngIf="constatPreviewUrl">
        <h4>Prévisualisation :</h4>
        
        <div *ngIf="showPdfViewer" class="pdf-preview">
          <pdf-viewer [src]="constatPreviewUrl" 
                     [render-text]="true"
                     style="width: 100%; height: 500px; border: 1px solid #ddd;">
          </pdf-viewer>
        </div>
        
        <div *ngIf="!showPdfViewer" class="image-preview">
          <img [src]="constatPreviewUrl" alt="Prévisualisation du constat">
        </div>
        
        <button class="btn-remove" (click)="removeConstat()">
          <i class="bi bi-trash"></i> Supprimer
        </button>
      </div>
      
      <p class="help-text">
        Vous n'avez pas de constat ? <br>
        Rendez-vous sur <a href="https://www.e-constat.fr" target="_blank">www.e-constat.fr</a> pour réaliser le vôtre.
      </p>
    </div>
  </div>
</div>
        <!-- Step 4: Photos -->
      <!-- Step 4: Photos -->
<!-- Step 4: Photos -->
<div class="step-content" *ngIf="currentStep === 4">
  <h2>Photos du véhicule accidenté</h2>
  
  <!-- Étape en cours -->
  <div class="photo-steps">
    <div class="step" [class.active]="currentPhotoStep === 1" (click)="setPhotoStep(1)">
      <span>1</span>
      <p>Photo d'ensemble</p>
    </div>
    <div class="step" [class.active]="currentPhotoStep === 2" (click)="setPhotoStep(2)">
      <span>2</span>
      <p>Plaque d'immatriculation</p>
    </div>
    <div class="step" [class.active]="currentPhotoStep === 3" (click)="setPhotoStep(3)">
      <span>3</span>
      <p>Numéro de série</p>
    </div>
    <div class="step" [class.active]="currentPhotoStep === 4" (click)="setPhotoStep(4)">
      <span>4</span>
      <p>Dégâts</p>
    </div>
  </div>

  <!-- Instructions spécifiques -->
  <div class="step-instructions">
    <div *ngIf="currentPhotoStep === 1">
      <h3><i class="bi bi-camera"></i> Photo d'ensemble du véhicule</h3>
      <p>Prenez une photo montrant l'ensemble du véhicule et son environnement immédiat.</p>
      <p class="help-text">Cette photo doit permettre d'identifier clairement le contexte de l'accident.</p>
    </div>
    
    <div *ngIf="currentPhotoStep === 2">
      <h3><i class="bi bi-123"></i> Plaque d'immatriculation</h3>
      <p>Photographiez clairement la plaque d'immatriculation avant ou arrière.</p>
      <p class="help-text">La plaque doit être lisible et non obstruée.</p>
    </div>
    
    <div *ngIf="currentPhotoStep === 3">
      <h3><i class="bi bi-upc-scan"></i> Numéro de série (VIN)</h3>
      <p>Prenez en photo la plaque constructeur située au bas du pare-brise côté conducteur.</p>
      <p class="help-text">Le numéro doit être clairement visible.</p>
    </div>
    
    <div *ngIf="currentPhotoStep === 4">
      <h3><i class="bi bi-exclamation-triangle"></i> Zones endommagées</h3>
      <p>Photographiez chaque zone endommagée sous différents angles.</p>
      <p class="help-text">Prenez au moins 2 photos par dégât (vue d'ensemble et détail).</p>
    </div>
  </div>

  <!-- Zone d'upload -->
  <div class="photo-upload-area" (click)="photoInput.click()">
    <div class="upload-icon">
      <i class="bi bi-camera"></i>
      <p>Ajouter une photo pour cette étape</p>
      <p class="photo-count">{{ getCurrentStepPhotos().length }} photo(s) ajoutée(s)</p>
    </div>
    <input #photoInput type="file" accept="image/jpeg,image/png" 
           (change)="onPhotoSelect($event, currentPhotoStep)" 
           style="display: none;" 
           [multiple]="currentPhotoStep === 4">
  </div>

  <!-- Gallery preview -->
  <div class="photo-gallery" *ngIf="getCurrentStepPhotos().length > 0">
    <div class="photo-grid">
      <div class="photo-item" *ngFor="let photo of getCurrentStepPhotos(); let i = index">
        <img [src]="photo.url" alt="Photo du sinistre">
        <div class="photo-overlay">
          <button class="btn-remove" (click)="removePhoto(i, currentPhotoStep); $event.stopPropagation()">
            <i class="bi bi-trash"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Navigation entre étapes -->
  <div class="step-navigation">
    <button class="btn-back" (click)="prevPhotoStep()" [disabled]="currentPhotoStep === 1">
      <i class="bi bi-chevron-left"></i> Étape précédente
    </button>
    
    <button class="btn-next" (click)="nextPhotoStep()" [disabled]="!canProceedPhotoStep()">
      {{ currentPhotoStep === 4 ? 'Terminer' : 'Étape suivante' }} 
      <i class="bi bi-chevron-right"></i>
    </button>
  </div>
</div>
        <!-- Step 5: Document Signing -->
      <!-- Step 5: Document Signing -->
<div class="step-content" *ngIf="currentStep === 5">
  <div class="document-signing" *ngIf="!allDocumentsSigned">
    
  <div class="document-preview">
  <p class="text-center fw-semibold text-muted p-2">Veuillez lire attentivement le document avant de le signer.</p>

  <div class="document-content">
    <pdf-viewer 
      [src]="currentPdf"
      [render-text]="true"
      [show-all]="true"
      style="width: 100%; height: 70vh; border: 1px solid #ddd;"
      (error)="currentPdfError = true">
    </pdf-viewer>

    <div *ngIf="currentPdfError" class="alert alert-danger mt-3">
      Le document n'a pas pu être chargé. Veuillez réessayer.
    </div>
  </div>

  <div class="signature-controls p-3 text-center">
 <label class="custom-checkbox">
  <input type="checkbox" [(ngModel)]="isChecked" />
  <span class="checkmark"></span>
  <span class="label-text">Je certifie avoir lu et approuvé le document {{ currentDocument }}</span>
</label>


    <button class="btn  btn-sign text-white"  style="background: linear-gradient(135deg, #1e4db8 0%, #8b2eb8 100%);"
            (click)="signDocument()" 
            [disabled]="!isChecked || isCurrentDocumentSigned || isSigning">
      <span *ngIf="!isSigning">Signer le document</span>
      <span *ngIf="isSigning">Signature en cours...</span>
    </button>
  </div>
</div>

  </div>


  <!-- Success Message -->
  <div class="success-message" *ngIf="allDocumentsSigned">
    <h2>Votre demande a été prise en compte</h2>
    <p>Un professionnel prendra contact avec vous dans quelques minutes</p>
   
     <div class="btn-contact" *ngIf="vehicleStatus === 'not-rolling'">
    <p>contactez l'Assistance :</p>
    <a href="tel:0761841419" class="assistance-number">07 61 84 14 19</a>
  </div>
  </div>
</div>


        <!-- Navigation Buttons -->
        <div class="navigation-buttons" *ngIf="!allDocumentsSigned">
          <button class="btn-back" (click)="previousStep()" [disabled]="currentStep === 1">
            Retour
          </button>
          <button class="btn-next" (click)="nextStep()" [disabled]="!canProceed()">
            suivant
          </button>
        </div>
      </div>
    