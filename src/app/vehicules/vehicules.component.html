<div class="container-fluid py-4">
  <div class="d-flex justify-content-end align-items-center mb-4">
    <!-- Bouton Ajouter un v√©hicule -->
    <button class="btn text-white border-0 px-4 py-2" (click)="showAddForm = true"
        style="background: linear-gradient(135deg, #1e4db8 0%, #8b2eb8 100%);">
  <i class="bi bi-plus-lg me-2"></i>
  Ajouter un v√©hicule
</button>

  </div>

  <!-- Modal Add Vehicle Form -->
  <div class="modal fade" [class.show]="showAddForm" [style.display]="showAddForm ? 'block' : 'none'" tabindex="-1" role="dialog" aria-modal="true" >
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">{{ isEditMode ? 'Modifier le v√©hicule' : 'Ajouter un nouveau v√©hicule' }}</h5>
          <button type="button" class="btn-close" (click)="cancelAdd()" aria-label="Close"></button>
        </div>
       <form (ngSubmit)="submitVehicle()" #vehicleForm="ngForm" class="modal-body">
  <!-- Immatriculation (toujours visible) -->
  <div class="mb-3">
    <label class="form-label fw-semibold">Immatriculation</label>
    <input type="text" class="form-control" [(ngModel)]="newVehicle.immatriculation" 
           name="immatriculation" (blur)="scrapperVehicules()" required 
           placeholder="Ex: AB-123-CD" [disabled]="isEditMode">
    <div *ngIf="scrapErrorMessage" class="text-danger mt-1 small">
      {{ scrapErrorMessage }}
    </div>
  </div>

  <!-- Champs visibles apr√®s scrapping -->
  <div *ngIf="scrappingReussi" class="fade-in">
    <div class="row mb-3">
      <div class="col-md-6">
        <label class="form-label fw-semibold">Marque</label>
        <input type="text" class="form-control" [(ngModel)]="newVehicle.marque"
               name="marque" required placeholder="Ex: Peugeot"
               [readonly]="!isEditMode">
      </div>
      <div class="col-md-6">
        <label class="form-label fw-semibold">Mod√®le</label>
        <input type="text" class="form-control" [(ngModel)]="newVehicle.modele"
               name="modele" required placeholder="Ex: 308"
               [readonly]="!isEditMode">
      </div>
    </div>

    <div class="row mb-3">
      <div class="col-md-6">
        <label class="form-label fw-semibold">Cylindr√©e</label>
        <input type="text" class="form-control" [(ngModel)]="newVehicle.cylindree"
               name="cylindree" required placeholder="Ex: 1.6L"
               [readonly]="!isEditMode">
      </div>
      <div class="col-md-6">
        <label class="form-label fw-semibold">Carte Grise</label>
        <input type="text" class="form-control" [(ngModel)]="newVehicle.carteGrise"
               name="carteGrise" required placeholder="Num√©ro carte grise"
               [readonly]="!isEditMode">
      </div>
    </div>

    <div class="row mb-3">
      <div class="col-md-6">
        <label class="form-label fw-semibold">Date de mise en circulation</label>
        <input type="date" class="form-control" [(ngModel)]="newVehicle.dateMiseEnCirculation"
               name="dateMiseEnCirculation" required
               [readonly]="!isEditMode">
      </div>
      <div class="col-md-6">
        <label class="form-label fw-semibold">Contrat d'Assurance</label>
        <input type="text" class="form-control" [(ngModel)]="newVehicle.contratAssurance"
               name="contratAssurance" required placeholder="Num√©ro de contrat"
               [readonly]="!isEditMode">
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="cancelAdd()">Annuler</button>
    <button type="submit"
            class="btn btn-primary"
            [ngStyle]="{
              background: 'linear-gradient(135deg, #1e4db8 0%, #8b2eb8 100%)',
              border: 'none'
            }"
            [disabled]="!vehicleForm.valid || (!scrappingReussi && !isEditMode)">
      {{ isEditMode ? 'Mettre √† jour' : 'Ajouter le v√©hicule' }}
    </button>
  </div>
</form>

      </div>
    </div>
  </div>
  <div class="modal-backdrop fade" [class.show]="showAddForm" [style.display]="showAddForm ? 'block' : 'none'"></div>

  <!-- Vehicles Grid -->
  <div class="row g-3">
    <div class="col-12 col-md-6 col-lg-4" *ngFor="let vehicle of vehicles">
      <div class="card h-100 shadow-sm border-0 overflow-hidden">
        <div class="position-relative bg-light" style="height: 180px;">
          <img *ngIf="vehicle.imgUrl; else defaultIcon" [src]="vehicle.imgUrl" class="h-100 w-100 object-fit-cover" alt="Image v√©hicule">
          <ng-template #defaultIcon>
            <div class="d-flex h-100 align-items-center justify-content-center">
              <span class="display-4 opacity-50">üöó</span>
            </div>
          </ng-template>
          <button class="btn btn-sm position-absolute top-0 end-0 m-2 bg-white rounded-circle p-2">
            <i class="bi bi-heart text-muted"></i>
          </button>
        </div>
        <div class="card-body">
          <h5 class="card-title">{{ vehicle.marque }} {{ vehicle.modele }}</h5>
          <p class="text-muted">{{ vehicle.dateMiseEnCirculation | date:'yyyy' }}</p>
          
          <div class="mb-3">
            <div class="d-flex justify-content-between py-2 border-bottom">
              <span class="text-muted">Immatriculation</span>
              <span class="fw-bold">{{ vehicle.immatriculation }}</span>
            </div>
            <div class="d-flex justify-content-between py-2 border-bottom">
              <span class="text-muted">Cylindr√©e</span>
              <span class="fw-bold">{{ vehicle.cylindree }}</span>
            </div>
          </div>
          
          <div class="d-flex justify-content-end gap-2">
            <button class="btn btn-sm btn-outline-success" (click)="updateVehicle(vehicle)">
              <i class="bi bi-pencil"></i>
            </button>
            <button class="btn btn-sm btn-outline-danger" (click)="deleteVehicle(vehicle.id)">
              <i class="bi bi-trash"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Loading Overlay -->
<div class="position-fixed top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center bg-dark bg-opacity-75" 
     style="z-index: 9999;" *ngIf="loadingScrap">
  <div class="text-center text-white">
    <div class="spinner-border mb-3" role="status">
      <span class="visually-hidden">Chargement...</span>
    </div>
    <p>Chargement des donn√©es du v√©hicule...</p>
  </div>
</div>
